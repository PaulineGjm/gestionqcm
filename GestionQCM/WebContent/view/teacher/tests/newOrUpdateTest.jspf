<%@ page  import ="java.util.*, java.text.*, fr.gestionqcm.model.bo.*" %>
<script type="text/javascript" src="${pageContext.servletContext.contextPath}/theme/js/newtest.js"></script>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<form action="${pageContext.servletContext.contextPath}/ValidateTest" method="post">
	<c:set var="test" value="${testToUpdate}" />
	<div>
		<label for="">Nom</label>
		<input type="text" name="name" value="${test.getName()}"/>
	</div>
	
	<div>
		<label for="">Durée (en minute)</label>
		<input type="text" name="duration" value="${test.getTestDuration()}"/>
	</div>
	
	<div>
		<label for="">Seuil en cours d'acquisition</label>
		<input type="text" name="beingacquired" value="${test.getAcquisitionThreshold()}"/>
	</div>
	
	<div>
		<label for="">Seuil acquis</label>
		<input type="text" name="acquired" value="${test.getCurrentThreshold()}"/>
	</div>
	
	<div id="sections">
		<label>Sections : </label>
		<input type="button" name="newsection" id="newsection" value="Nouvelle section"/>
	
		<div class="section" style="display:none">
			<label for="">Section</label>
			<select name="theme">
				<c:forEach items="${themes}" var="theme">
					<c:if test="${theme != null}">
						<option value="${theme.getId()}">
							${theme.getLabel()}
						</option>
					</c:if>
				</c:forEach>
			</select>
			Nombre de questions : <input type="text" name="nbquestion" class="nbquestion"/>
			<input type="button" name="deletesection" class="deletesection" value="-"/>
		</div>
		
		<c:forEach items="${test.getSections()}" var="section" varStatus="count">
			<div class="section">
				<label for="">Section</label>
				<select name="theme_${count.count} ">
					<c:forEach items="${themes}" var="theme">
						<c:if test="${theme != null}">
							<c:set var="selected" value=""/>
							<c:if test="${section.getIdTheme() == theme.getId()}">
								<c:set var="selected" value="selected"/>
							</c:if>
							<option value="${theme.getId()}" ${selected}>
								${theme.getLabel()}
							</option>
						</c:if>
					</c:forEach>
				</select>
				Nombre de questions : <input type="text" name="nbquestion_${count.count}" class="nbquestion" value="${section.getNbQuestions()}"/>
				<input type="button" name="deletesection" class="deletesection" value="-"/>
			</div>
		</c:forEach>
		
	</div>
	
	<input type="submit" name="newtest" value="Valider"/>
	
	<c:set var="action" value="update"/>
	<c:if test="${test == null}">
	   <c:set var="action" value="add"/>
	</c:if>
	<input type="hidden" name="action" value="${action}"/>
</form>

	<%-- <form action="<%=request.getContextPath()%>/ListTests" method="post">
		<input type="submit" name="cancel" value="Annuler"/>
	</form> --%>